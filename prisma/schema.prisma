// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Używa zmiennej ustawionej w docker-compose.yml
  url      = env("DATABASE_URL")
}

// 1. Użytkownik
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String   // Pamiętaj: hasło będzie haszowane
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ratings   Rating[]
  comments  Comment[]
}

// 2. Tytuł (Film, Książka, Gra)
model Title {
  id            Int      @id @default(autoincrement())
  title         String
  type          String   // 'movie', 'book', 'game'
  releaseYear   Int?
  posterUrl     String?
  description   String?

  ratings       Rating[]
  comments      Comment[]
}

// 3. Ocena
model Rating {
  userId    Int
  titleId   Int
  score     Int // Ocena np. od 1 do 10
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User   @relation(fields: [userId], references: [id])
  title     Title  @relation(fields: [titleId], references: [id])

  @@id([userId, titleId]) // Klucz złożony: jeden użytkownik, jedna ocena na tytuł
}

// 4. Komentarz
model Comment {
  id        Int      @id @default(autoincrement())
  content   String
  userId    Int
  titleId   Int
  createdAt DateTime @default(now())

  user      User   @relation(fields: [userId], references: [id])
  title     Title  @relation(fields: [titleId], references: [id])
}